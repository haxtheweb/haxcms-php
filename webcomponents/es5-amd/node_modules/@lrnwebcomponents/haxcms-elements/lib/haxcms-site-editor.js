define(["../../../@polymer/polymer/polymer-legacy.js","../../../@polymer/polymer/lib/utils/async.js","../../../@polymer/paper-fab/paper-fab.js","../../../@polymer/paper-tooltip/paper-tooltip.js","../../../@polymer/paper-button/paper-button.js","../../../@polymer/iron-ajax/iron-ajax.js","../../../@polymer/iron-icons/editor-icons.js","../../jwt-login/jwt-login.js","../../h-a-x/h-a-x.js","../../simple-toast/simple-toast.js","../../simple-modal/simple-modal.js","./haxcms-site-editor-ui.js"],function(_polymerLegacy,async){"use strict";async=babelHelpers.interopRequireWildcard(async);function _templateObject_79c27810152211e9ab85edf03c468fa7(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style is=\"custom-style\">\n      :host {\n        display: block;\n      }\n      #editbutton {\n        position: fixed;\n        bottom: 0;\n        right: 0;\n        margin: 16px;\n        padding: 2px;\n        width: 40px;\n        height: 40px;\n        visibility: visible;\n        opacity: 1;\n        transition: all 0.4s ease;\n        z-index: 1000;\n      }\n      #outlinebutton {\n        position: fixed;\n        bottom: 0;\n        right: 46px;\n        margin: 16px;\n        padding: 2px;\n        width: 40px;\n        height: 40px;\n        visibility: visible;\n        opacity: 1;\n        transition: all 0.4s ease;\n        z-index: 1000;\n      }\n      :host([edit-mode]) #editbutton {\n        width: 100%;\n        z-index: 100;\n        right: 0;\n        bottom: 0;\n        border-radius: 0;\n        height: 80px;\n        margin: 0;\n        padding: 8px;\n        background-color: var(--paper-blue-500) !important;\n      }\n      h-a-x {\n        padding: 48px;\n        max-width: 1040px;\n        margin: auto;\n        display: none;\n      }\n      :host([edit-mode]) h-a-x {\n        display: block;\n        padding: 0 !important;\n      }\n    </style>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"pageupdateajax\"\n      url=\"[[savePagePath]]\"\n      method=\"POST\"\n      body=\"[[updatePageData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handlePageResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"outlineupdateajax\"\n      url=\"[[saveOutlinePath]]\"\n      method=\"POST\"\n      body=\"[[updateOutlineData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleOutlineResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"manifestupdateajax\"\n      url=\"[[saveManifestPath]]\"\n      method=\"POST\"\n      body=\"[[updateManifestData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleManifestResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"publishajax\"\n      loading=\"{{publishing}}\"\n      url=\"[[publishPath]]\"\n      method=\"POST\"\n      body=\"[[publishSiteData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handlePublishResponse\"\n    ></iron-ajax>\n    <h-a-x app-store$=\"[[appStore]]\"></h-a-x>\n    <haxcms-site-editor-ui\n      id=\"ui\"\n      active-item=\"[[activeItem]]\"\n      manifest=\"[[manifest]]\"\n      edit-mode=\"{{editMode}}\"\n    ></haxcms-site-editor-ui>\n  "]);_templateObject_79c27810152211e9ab85edf03c468fa7=function(){return data};return data}(0,_polymerLegacy.Polymer)({is:"haxcms-site-editor",_template:(0,_polymerLegacy.html)(_templateObject_79c27810152211e9ab85edf03c468fa7()),properties:{jwt:{type:String},savePagePath:{type:String},saveManifestPath:{type:String},publishPath:{type:String},publishing:{type:Boolean,observer:"_publishingChanged"},saveOutlinePath:{type:String},appStore:{type:Object},editMode:{type:Boolean,reflectToAttribute:!0,observer:"_editModeChanged",value:!1},updatePageData:{type:Object,value:{}},publishSiteData:{type:Object,value:{}},updateOutlineData:{type:Object,value:{}},updateManifestData:{type:Object,value:{}},activeItem:{type:Object,notify:!0,observer:"_activeItemChanged"},manifest:{type:Object,notify:!0}},_attachDom:function _attachDom(dom){this.appendChild(dom)},ready:function ready(){window.SimpleToast.requestAvailability();window.SimpleModal.requestAvailability();window.addEventListener("hax-store-ready",this._storeReadyToGo.bind(this));window.addEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this));window.addEventListener("json-outline-schema-changed",this._manifestChanged.bind(this));window.addEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this));window.addEventListener("haxcms-save-outline",this.saveOutline.bind(this));window.addEventListener("haxcms-save-site-data",this.saveManifest.bind(this));window.addEventListener("haxcms-publish-site",this.publishSite.bind(this))},attached:function attached(){var _this=this,evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"You are logged in, edit tools shown."}});this.dispatchEvent(evt);if(babelHelpers.typeof(this.__body)!=="undefined"){window.HaxStore.instance.activeHaxBody.importContent(this.__body)}async.microTask.run(function(){if(babelHelpers.typeof(window.cmsSiteEditor.jsonOutlineSchema)!=="undefined"){_this.set("manifest",window.cmsSiteEditor.jsonOutlineSchema);_this.notifyPath("manifest.*")}if(babelHelpers.typeof(window.cmsSiteEditor.initialActiveItem)!=="undefined"){_this.set("activeItem",window.cmsSiteEditor.initialActiveItem);_this.notifyPath("activeItem.*")}_this.updateStyles();if(window.HaxStore.ready){_this._storeReadyToGo({detail:!0})}})},detached:function detached(){window.removeEventListener("hax-store-ready",this._storeReadyToGo.bind(this));window.removeEventListener("haxcms-save-outline",this.saveOutline.bind(this));window.removeEventListener("haxcms-save-site-data",this.saveManifest.bind(this));window.removeEventListener("haxcms-publish-site",this.publishSite.bind(this));window.removeEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this));window.removeEventListener("json-outline-schema-changed",this._manifestChanged.bind(this));window.removeEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this))},_storeReadyToGo:function _storeReadyToGo(event){if(event.detail){window.HaxStore.instance.haxManager.appendJwt="jwt";window.HaxStore.instance.haxPanel.align="left";window.HaxStore.instance.haxPanel.hidePanelOps=!0}},_publishingChanged:function _publishingChanged(newValue,oldValue){if(newValue){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Publishing...",duration:0}});this.dispatchEvent(evt)}else if(!newValue&&oldValue){new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Publishing...",duration:3e3}})}},_manifestChanged:function _manifestChanged(e){this.set("manifest",{});this.set("manifest",e.detail);this.notifyPath("manifest.*")},_newActiveItem:function _newActiveItem(e){this.set("activeItem",e.detail);this.notifyPath("activeItem.*")},_activeItemChanged:function _activeItemChanged(newValue){if(newValue){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();window.HaxStore.instance.haxManager.appendUploadEndPoint="siteName="+site+"&page="+newValue.id}},_handlePageResponse:function _handlePageResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Page saved!",duration:3e3}});this.dispatchEvent(evt);this.fire("haxcms-trigger-update-page",!0)},_handleOutlineResponse:function _handleOutlineResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Outline saved!",duration:3e3}});this.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0)},_handleManifestResponse:function _handleManifestResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Site details saved!",duration:3e3}});this.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0)},_handlePublishResponse:function _handlePublishResponse(e){var data=e.detail.response,content=document.createElement("span");content.innerHTML="\n    <a href=\"".concat(data.url,"\" target=\"_blank\">\n      <paper-button raised style=\"color:yellow;text-transform: none;font-weight: bold;\">\n      ").concat(data.label,"\n      </paper-button>\n    </a>");var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:data.response,duration:0,slot:content.cloneNode(!0)}});this.dispatchEvent(evt)},_editModeChanged:function _editModeChanged(newValue,oldValue){if(!newValue&&oldValue){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("updatePageData.siteName",site);this.notifyPath("updatePageData.siteName");this.set("updatePageData.body",window.HaxStore.instance.activeHaxBody.haxToContent());this.notifyPath("updatePageData.body");this.set("updatePageData.page",this.activeItem.id);this.notifyPath("updatePageData.page");this.set("updatePageData.jwt",this.jwt);this.notifyPath("updatePageData.jwt");if(this.savePagePath){this.$.pageupdateajax.generateRequest()}this.fire("haxcms-save-page",this.activeItem)}},saveOutline:function saveOutline(e){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("updateOutlineData.siteName",site);this.notifyPath("updateOutlineData.siteName");this.set("updateOutlineData.items",e.detail);this.notifyPath("updateOutlineData.items");this.set("updateOutlineData.jwt",this.jwt);this.notifyPath("updateOutlineData.jwt");if(this.saveOutlinePath){this.$.outlineupdateajax.generateRequest()}},saveManifest:function saveManifest(e){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("updateManifestData.siteName",site);this.notifyPath("updateManifestData.siteName");this.set("updateManifestData.manifest",e.detail);this.notifyPath("updateManifestData.manifest");this.set("updateManifestData.jwt",this.jwt);this.notifyPath("updateManifestData.jwt");if(this.saveManifestPath){this.$.manifestupdateajax.generateRequest()}},publishSite:function publishSite(){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("publishSiteData.siteName",site);this.notifyPath("publishSiteData.siteName");this.set("publishSiteData.jwt",this.jwt);this.notifyPath("publishSiteData.jwt");if(this.publishPath){this.$.publishajax.generateRequest()}},_bodyChanged:function _bodyChanged(e){window.HaxStore.instance.activeHaxBody.importContent(e.detail)}})});