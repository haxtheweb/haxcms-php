globalThis.document;const t={start:1,loading:2,ready:3,typesetting:4,error:5};let e,a,n=[],s=t.start,i="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js";function flush_typesets(){if(!n.length)return;const i=[],r=[];n.forEach((function(t){const e=globalThis.document.createElement("script"),a=globalThis.document.createElement("div");e.type=t[1]?"math/tex; mode=display":"math/tex",e.text=t[0],a.style.position="fixed",a.style.top=0,a.style.left="99999px",a.appendChild(e),globalThis.document.body.appendChild(a),i.push(e),r.push([a,t[2]])})),n=[],s=t.typesetting,e.Queue(["Typeset",e,i]),e.Queue((function(){a||function getStyleNode(){const t=globalThis.document.querySelectorAll("style"),e=Array.prototype.filter.call(t,(function(t){return t.sheet&&t.sheet.cssRules.length>100&&".mjx-chtml"===t.sheet.cssRules[0].selectorText}));a=e[0]}(),r.forEach((function(t){const e=t[0],n="SPAN"===e.firstElementChild.tagName?e.firstElementChild:null;t[1](n,a),globalThis.document.body.removeChild(e)})),s=t.ready,flush_typesets()}))}function load_library(){s=t.loading,globalThis.MathJax={skipStartupTypeset:!0,showMathMenu:!1,jax:["input/TeX","output/CommonHTML"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},AuthorInit(){e=globalThis.MathJax.Hub,e.Register.StartupHook("End",(function(){s=t.ready,flush_typesets()}))}};var a=globalThis.document.createElement("script");a.type="text/javascript",a.src=i,a.async=!0,a.onerror=function(){console.warn("Error loading MathJax library "+i),s=t.error,n=[]},globalThis.document.head.appendChild(a)}class LrnMathController extends HTMLElement{connectedCallback(){this.hasAttribute("src")&&(i=this.getAttribute("src")),this.hasAttribute("lazy")||load_library()}typeset(e,a,i){s!==t.error&&(n.push([e,a,i]),s===t.start?load_library():s===t.ready&&flush_typesets())}}const r="lrn-math-controller",h={childList:!0,characterData:!0,attributes:!0,subtree:!0};let o;class LrnMath extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._private={check:"",observer:new MutationObserver((()=>{this.updateMath()}))},this._private.observer.observe(this,h)}static get tag(){return"lrn-math"}haxHooks(){return{editModeChanged:"haxeditModeChanged",activeElementChanged:"haxactiveElementChanged"}}haxactiveElementChanged(t,e){e&&(this._haxstate=e)}haxeditModeChanged(t){this._haxstate=t}connectedCallback(){!function check_handler(t){o||(o=globalThis.document.querySelector(r)||globalThis.document.createElement(r),!globalThis.document.contains(o)&&globalThis.document&&globalThis.document.head&&globalThis.document.head.appendChild(o),setTimeout((()=>{t.refresh()}),0))}(this),setTimeout((()=>{this._haxstate&&this.innerHTML?this.mathtext=this.innerHTML:this.updateMath()}),0)}updateMath(){const t=this.shadowRoot,e=this.textContent.trim(),a="display"===this.getAttribute("mode"),n=(a?"D":"I")+e;this._private&&n!==this._private.check&&(this.shadowRoot.innerHTML="",this._private.check=n,e.length&&o&&o.typeset(e,a,(function(e,a){t.appendChild(a.cloneNode(!0)),t.appendChild(e)})))}get mathtext(){return this.getAttribute("mathtext")}set mathtext(t){this.setAttribute("mathtext",t)}static get observedAttributes(){return["mathtext"]}attributeChangedCallback(t,e,a){if("mathtext"===t)""!==a&&null!==a?(clearTimeout(this._typingTimeout),this._typingTimeout=setTimeout((()=>{const t=globalThis.document.createElement("span");t.innerText=a,this.innerHTML="",this.appendChild(t)}),300)):this.updateMath()}static get haxProperties(){return{canScale:!1,canEditSource:!0,gizmo:{title:"Math",description:"Present math in a nice looking way.",icon:"hax:pi",color:"grey",tags:["Instructional","math","mathjax","mathml","latex","mathml"],handles:[{type:"math",math:"mathText"},{type:"inline",text:"mathText"}],meta:{author:"HAXTheWeb core team",inlineOnly:!0}},settings:{inline:[],configure:[{property:"mathtext",title:"Math",description:"Enter equation as MathML",inputMethod:"textarea"}],advanced:[]}}}refresh(){let t=globalThis.document.createElement("lrn-math");this.parentNode.insertBefore(t,this),t.innerHTML=this.innerHTML,this.remove()}}customElements.define("lrn-math",LrnMath);export{LrnMath};customElements.define("lrn-math-controller",LrnMathController);export{LrnMathController};