/**
 * Copyright 2025 haxtheweb
 * @license Apache-2.0, see LICENSE for full text.
 */
import{LitElement as t,html as i,css as e}from"../../lit/index.js";import{HAXCMSLitElementTheme as o}from"../haxcms-elements/lib/core/HAXCMSLitElementTheme.js";import{store as a}from"../haxcms-elements/lib/core/haxcms-site-store.js";import{autorun as r,toJS as s}from"../../mobx/dist/mobx.esm.js";import"../haxcms-elements/lib/ui-components/active-item/site-active-title.js";import"../haxcms-elements/lib/ui-components/active-item/site-active-media-banner.js";import"../scroll-button/scroll-button.js";import"../simple-icon/lib/simple-icon-button-lite.js";import"../simple-icon/lib/simple-icon-lite.js";import{DDDSuper as l}from"../d-d-d/d-d-d.js";import{DDDVariables as n}from"../d-d-d/lib/DDDStyles.js";import{licenseList as c}from"../license-element/license-element.js";import{UserScaffoldInstance as d}from"../user-scaffold/user-scaffold.js";const p=["https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap"];function getPostLogo(t){return t.metadata.image?t.metadata.image:a.manifest.metadata.theme.variables.image?s(a.manifest.metadata.theme.variables.image):s(a.manifest.metadata.site.logo)}export class CleanPortfolioTheme extends(l(o)){static get tag(){return"clean-portfolio-theme"}constructor(){super(),this.siteTheme=d.readMemory("HAXCMSSiteTheme")||"",this.dataPrimary=2,this.selectedTag="",this.activeLayout="text",this.menuOpen=!1,this.menuOverflow=[],this.lastUpdated="",this.copyrightYear=0,this.HAXSiteCustomRenderRoutes={"x/tags":{items:this.HAXSiteRenderXTagsItems}},this.HAXCMSThemeSettings.autoScroll=!0,this.categoryTags=[],this.allTags=[],this.items=[],this.__disposer=this.__disposer||[],r((t=>{this.homeLink=s(a.homeLink),this.__disposer.push(t)})),r((t=>{this.siteTitle=s(a.siteTitle),this.__disposer.push(t)})),r((t=>{this.ancestorItem=s(a.ancestorItem),this.__disposer.push(t)})),r((t=>{let i=s(a.activeTags);i&&i.length>0?this.activeTags=i.split(","):this.activeTags=[],this.__disposer.push(t)})),r((t=>{let i=a.getItemChildren(null);i&&i.length>0&&(this.topItems=[...i]),this.__disposer.push(t)})),r((t=>{const i=s(a.activeItem);if(i){let t=a.manifest.items.find((t=>i.parent===t.id));if(t){const t=i.metadata.tags?.split(",").map((t=>t.trim()))?.[0]||null,e=a.manifest.items.filter((e=>{const o=e.metadata?.tags?.split(",").map((t=>t.trim()))?.[0]||null;return e.parent===i.parent&&o===t})),o=e.findIndex((t=>t.id===i.id));this.prevSibling=e[o-1]||null,this.nextSibling=e[o+1]||null}else t="";this.menuOpen&&(this.menuOpen=!1),globalThis.document&&globalThis.document.startViewTransition?globalThis.document.startViewTransition((()=>{this.activeItem=i,this.activeParent=t})):(this.activeItem=i,this.activeParent=t);const e=a.getItemChildren(a.activeId);if(e)if(e.length>0){this.setLayout("listing");const t=[],i=[];if(e.forEach((e=>{let o=s(e.metadata.tags);if(o){const e=o.split(",");e[0]&&!t.includes(e[0])&&t.push(e[0]),e.forEach((t=>{t&&!i.includes(t)&&i.push(t)}))}})),globalThis.document&&globalThis.document.startViewTransition?globalThis.document.startViewTransition((()=>{this.items=[...e],this.categoryTags=[...t],this.allTags=[...i]})):(this.items=[...e],this.categoryTags=[...t],this.allTags=[...i]),this.selectedTag="",this.shadowRoot){let t=this.shadowRoot.querySelector("#listing-filter");t&&(t.value="")}}else i.parent?this.setLayout("media"):this.setLayout("text")}this.__disposer.push(t)})),r((t=>{if(s(a.editMode)){(this.shadowRoot.querySelector("#slot")||globalThis.document.querySelector("#slot")).scrollIntoView({behavior:"smooth",block:"start"})}this.__disposer.push(t)})),r((t=>{this.manifest=s(a.manifest);let i=new c;this.manifest.license&&i[this.manifest.license]&&(this.licenseName=i[this.manifest.license].name,this.licenseLink=i[this.manifest.license].link,this.licenseImage=i[this.manifest.license].image),this.__disposer.push(t)})),r((t=>{const i=s(a.pageCounter);this.pageCurrent=i.current,this.pageTotal=i.total,this.__disposer.push(t)}))}firstUpdated(t){super.firstUpdated(t);let i=globalThis.DesignSystemManager.requestAvailability();i.addDesignSystem({name:"clean-portfolio-theme",styles:[...CleanPortfolioTheme.styles,n],fonts:p,hax:!0}),i.active="clean-portfolio-theme",this.lastUpdated=new Date(1e3*a.manifest.metadata.site.updated).toDateString(),this.copyrightYear=new Date(1e3*a.manifest.metadata.site.created).getFullYear();const e=this.renderRoot.querySelector("nav");e&&(this._resizeObserver=new ResizeObserver((()=>{this._checkOverflow()})),this._resizeObserver.observe(e)),requestAnimationFrame((()=>this._checkOverflow()))}updated(t){if(super.updated(t),t.has("siteTheme")){switch(this.siteTheme){case"earth":default:this.dataPrimary=1;break;case"water":this.dataPrimary=11;break;case"fire":this.dataPrimary=23;break;case"sand":this.dataPrimary=35;break;case"rose":this.dataPrimary=47;break;case"violet":this.dataPrimary=2}d.writeMemory("HAXCMSSiteTheme",this.siteTheme,"long")}}disconnectedCallback(){if(this._resizeObserver&&this._resizeObserver.disconnect(),this.__disposer)for(var t in this.__disposer)this.__disposer[t].dispose();super.disconnectedCallback()}_checkOverflow(){const t=this.renderRoot.querySelector("nav");if(t){const i=Array.from(t.children),e=t.clientWidth-100;let o=0;const a=[];for(const t of i)t.style.display="inline-block",o+=t.offsetWidth+25,o>e&&(t.style.display="none",a.push(this.topItems.find((i=>i.slug===t.getAttribute("href")))));this.menuOverflow=a,this.requestUpdate()}}static get properties(){return{...super.properties,activeItem:{type:Object},activeParent:{type:Object},ancestorItem:{type:Object},prevSibling:{type:Object},nextSibling:{type:Object},topItems:{type:Array},items:{type:Array},activeTags:{type:Array},categoryTags:{type:Array},allTags:{type:Array},menuOverflow:{type:Array},menuOpen:{type:Boolean},copyrightYear:{type:Number},pageCurrent:{type:Number},pageTotal:{type:Number},siteTitle:{type:String},homeLink:{type:String},activeLayout:{type:String},selectedTag:{type:String},lastUpdated:{type:String},licenseName:{type:String},licenseLink:{type:String},licenseImage:{type:String},dataPrimary:{type:String,attribute:"data-primary",reflect:!0},siteTheme:{type:String,reflect:!0,attribute:"site-theme"}}}HAXCMSGlobalStyleSheetContent(){return[...super.HAXCMSGlobalStyleSheetContent(),e`
        :root, html, body {
            /* site color variables */
            --portfolio-black: #000000;
            --portfolio-white: #ffffff;
            --portfolio-lighterGrey: #bfbfbf;
            --portfolio-lightGrey: #8a8a8a;
            --portfolio-grey: #424242;
            --portfolio-darkGrey: #333;
            --portfolio-textHeader: #efefef;
            --portfolio-textHeaderHover: #b7b7b7;
            --portfolio-menuItemUnderline: #ff0000;
            --portfolio-cardTag: #6D4C41;
            --portfolio-cardTagLight: #c2a399;
            --portfolio-linkLight: #1F26FF;
            --portfolio-linkDark: #a2a5ff;
            --portfolio-bgLight: #f7f7f7;
            --portfolio-bgDark: #262626;

            --portfolio-lightDark-blackWhite: light-dark(var(--portfolio-black), var(--portfolio-white));
            --portfolio-lightDark-bg: light-dark(var(--portfolio-bgLight), var(--portfolio-bgDark));
            --portfolio-lightDark-footer: light-dark(var(--portfolio-black), var(--portfolio-darkGrey));
            --portfolio-lightDark-cardTag: light-dark(var(--portfolio-cardTag), var(--portfolio-cardTagLight));
            --portfolio-lightDark-cardImg: light-dark(var(--portfolio-lighterGrey), var(--portfolio-darkGrey));
            --portfolio-lightDark-link: light-dark(var(--portfolio-linkLight), var(--portfolio-linkDark));

            --portfolio-accentHighlight: var(--portfolio-lightDark-blackWhite);

            /* site font variables */
            --portfolio-font-body: "Source Code Pro", system-ui, Monaco, Consolas, "Lucida Console", monospace;
            --portfolio-font-header: "Work Sans", system-ui, -apple-system, BlinkMacSystemFont, "Roboto", "Segoe UI", "Helvetica Neue", "Lucida Grande", Arial, sans-serif;

            --portfolio-fontsize-responsive: clamp(16px, 2vw, 22px);

            background-color: var(--portfolio-lightDark-bg);
            font-family: var(--portfolio-font-body);
            font-size: var(--portfolio-fontsize-responsive);
            color-scheme: light dark;
            scroll-behavior: smooth;
            /* theme colors */
            --portfolio-earth-accentLight: #689f38;
            --portfolio-earth-accentDark: #33691e;
            --portfolio-water-accentLight: #2a95cf;
            --portfolio-water-accentDark: #1e53a2;
            --portfolio-fire-accentLight: #F49B99;
            --portfolio-fire-accentDark: #8e2424;
            --portfolio-sand-accentLight: #f57c00;
            --portfolio-sand-accentDark: #6d4c41;
            --portfolio-rose-accentLight: #e770ad;
            --portfolio-rose-accentDark:  #6a1b4d;
            --portfolio-violet-accentLight: #a392d0;
            --portfolio-violet-accentDark:  #392b6a;
        }

        body.dark-mode {
          color-scheme: only dark;
        }
        site-tags-route::part(simple-tag) {
          border-color: var(--portfolio-darkGrey);
        }
        site-tags-route::part(simple-tag):hover,
        site-tags-route::part(simple-tag):focus {
          color: var(--portfolio-lightGrey);
          border-color: var(--portfolio-lightGrey);
          font-family: var(--portfolio-font-header);
        }

        site-tags-route::part(listing-grid) {
          display: grid;
          gap: 24px;
          width: 100%;
          view-transition-name: location;
          grid-template-columns: repeat(4, 1fr);
        }
        

        site-tags-route::part(listing-card) {
          width: 188px;
          margin-bottom: 48px;
          text-decoration: none;
          transition: .4s;
        }

        site-tags-route::part(listing-cardimg) {
          background-color: var(--portfolio-lightDark-cardImg);
          border-radius: 6px;
          margin-bottom: 12px;
          height: 120px;
          transition: all 0.2s ease-in-out;
          overflow: hidden;
          display: block;
        }

        site-tags-route::part(listing-cardimg-img) {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        site-tags-route::part(listing-cardtitle) {
          color: var(--portfolio-lightDark-blackWhite);
          text-decoration: underline;
          text-decoration-color: var(--portfolio-lightDark-bg);
          text-decoration-thickness: 4px !important;
          text-underline-offset: 8px;
          font-family: var(--portfolio-font-header);
          font-weight: 400;
          line-height: 1.7;
          font-size: clamp(15px, 2vw, 21px);
          text-transform: uppercase;
          margin-bottom: 5.5px;
          transition: color, text-decoration-color .3s ease-in-out;
        }

        site-tags-route::part(listing-cardtag) {
          color: var(--portfolio-lightDark-cardTag);
          font-family: var(--portfolio-font-body);
          font-size: clamp(10px, 2vw, 16px);
          font-weight: 400;
          transition: .3s;
        }

      site-tags-route::part(listing-cardtitle):hover,
      site-tags-route::part(listing-cardtitle):focus {
        text-decoration-color: var(--portfolio-accentHighlight);
      }

      site-tags-route::part(listing-cardimg):hover,
      site-tags-route::part(listing-cardimg):focus {
        box-shadow: rgba(0, 0, 0, 0.25) 0px 0px 10px 0px;
      }
`]}static get styles(){return[super.styles,e`
      /* Semantic elements */
      :host {
        display: block;
        background-color: var(--portfolio-lightDark-bg);
        transition: background-color .3s ease-in-out;
      }

      html, body {
        height: 100%;
        background-color: var(--portfolio-lightDark-bg);
      }

      header {
        background-color: var(--portfolio-darkGrey);
        transition: all 0.2s ease-in-out;
        padding: 22px;
      }

      .header-inner {
        display: flex;
        align-items: center;
        width: 100%;
        max-width: 1236px;
        margin: 0 auto;
        line-height: 1.7;
        position: relative;
      }

      nav {
        display: flex;
        gap: .5rem;
        justify-content: flex-end;
        flex: 1 1 auto;
        min-width: 0;
      }

      a {
        color: var(--portfolio-lightDark-link);
        transition: color .3s;
      }

      h1, h2, h3, h4, h5, h6 {
        color: var(--portfolio-lightDark-blackWhite);
        line-height: 1.2;
        font-weight: 700;
        margin-bottom: 0.75rem;
        margin-top: 0;
      }
      
      p {
        color: var(--portfolio-lightDark-blackWhite);
        font-size: var(--portfolio-fontsize-responsive);
        line-height: 1.5;
        margin-bottom: 1.3em;
      }

      ul {
        color: var(--portfolio-lightDark-blackWhite);
        list-style-type: disc;
      }

      li {
        font-family: var(--portfolio-font-body);
      }

      li::marker {
        color: var(--portfolio-lightDark-blackWhite) !important;
      }

      footer {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        background-color: var(--portfolio-darkGrey);
        color: var(--portfolio-white);
        font-family: var(--portfolio-font-body);
        font-size: clamp(11px, 2vw, 15px);
        padding: 40px 5vw;
        margin-top: 96px;
        transition: .3s;
      }

      .footer-link {
        color: white !important;
        transition: color .3s;
      }

      .page-counter {
        font-family: var(--portfolio-font-body);
        font-size: 0.9rem;
        color: var(--portfolio-lightDark-blackWhite);
        margin: 0 0 1rem;
      }

      :focus {
        outline-offset: 8px;
      }

      /* Site header elements */
      #site-title {
        padding: 0.5rem;
        color: var(--portfolio-textHeader);
        font-family: var(--portfolio-font-header);
        font-weight: bold;
        font-size: var(--portfolio-fontsize-responsive);
        text-transform: uppercase;
        text-decoration: none;
        border: 5px solid white;
        transition: all 0.2s ease-in-out;
      }

      #site-title:hover,
      #site-title:focus {
        color: var(--portfolio-textHeaderHover);
      }

      header a.menu-item {
        display: inline-block;
        position: relative;
        margin: 10px;
        padding: 0 5px;
        white-space: nowrap;
        color: var(--portfolio-textHeader);
        font-family: var(--portfolio-font-header);
        font-size: var(--portfolio-fontsize-responsive);
        font-weight: 450;
        text-align: center;
        text-decoration: none;
        transition: all 0.3s ease-in-out;
      }

      header a.menu-item:after {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 50%;
        width: 0;
        height: clamp(0.1em, 5vw, 0.2em);
        background-color: var(--portfolio-menuItemUnderline);
        transform: translateX(-50%);
        transition: all 0.2s ease-in-out;
      }

      .menu-item:hover,
      .menu-item:focus,
      .menu-item.active {
        color: var(--portfolio-textHeaderHover);
      }

      .menu-item:hover:after,
      .menu-item:focus:after,
      .menu-item.active:after {
        width: 100%;
        transform: translateX(-50%) scaleX(1);
      }

      /* Mobile menu */
      .mobile-menu-wrapper {
        position: relative;
        display: flex;
        justify-content: center;
      }

      header button {
          display: inline-block;
          color: #fff;
          background-color: var(--portfolio-lightGrey);
          border: 0;
          width: 45px;
          height: 50px;
          cursor: pointer;
          margin-left: 10px;
          transition: all 0.2s ease-in-out;
      }

      .navicon {
          position: relative;
          width: 1.5rem;
          height: .25rem;
          background: #fff;
          margin: auto;
          transition: .3s;
      }

      .navicon:before,
      .navicon:after {
          content: "";
          position: absolute;
          left: 0;
          width: 1.5rem;
          height: .25rem;
          background: #fff;
          transition: .3s;
      }

      .navicon:before {
          top: -0.5rem;
      }

      .navicon:after {
          bottom: -0.5rem;
      }

      .close .navicon {
          background: rgba(0,0,0,0);
      }

      .close .navicon:before,
      .close .navicon:after {
          transform-origin: 50% 50%;
          top: 0;
          width: 1.5rem;
      }

      .close .navicon:before {
          transform: rotate3d(0, 0, 1, 45deg);
      }

      .close .navicon:after {
          transform: rotate3d(0, 0, 1, -45deg);
      }

      .hidden-links {
        position: absolute;
        top: calc(100% + 12px);
        right: 0;
        padding: 5px;
        gap: 0;
        border-radius: 4px;
        box-shadow: 0 2px 4px 0 rgba(#000, 0.16), 0 2px 10px 0 rgba(#000, 0.12);
        background-color: var(--portfolio-lightGrey);
        z-index: 5;
        transition: .3s;
      }

      .hidden-links:before {
        content: "";
        position: absolute;
        top: -8px;
        right: 12px;
        border-style: solid;
        border-width: 0 10px 10px;
        border-color: var(--portfolio-lightGrey) transparent;
        transition: .3s;
      }

      .hidden-links li {
        display: block;
        border-bottom: 1px solid var(--portfolio-white);
        padding: 10px;
      }

      .hidden-links li:last-child {
        border-bottom: none;
      }

      .hidden-links a {
        color: var(--portfolio-white);
        font-size: 16px;
        font-weight: 400;
        font-family: var(--portfolio-font-header);
        text-decoration: none;
        display: block;
        transition: .3s;
      }

      .hidden-links a:hover,
      .hidden-links a:focus,
      .hidden-links a.active {
        color: var(--portfolio-grey);
      }

      .hidden {
        display: none;
      }

      .visually-hidden,
      .screen-reader-text,
      .screen-reader-text span,
      .screen-reader-shortcut {
        position: absolute !important;
        clip: rect(1px, 1px, 1px, 1px);
        height: 1px !important;
        width: 1px !important;
        border: 0 !important;
        overflow: hidden;
      }

      /* Imported elements */
      site-active-title h1 {
        font-family: "Playfair Display";
        font-size: 88px;
        font-weight: bold;
        transition: .3s;
        view-transition-name: location;
      }

      site-active-media-banner {
        --media-banner-background-color: none;
        --media-banner-height: clamp(320px, 80vw, 640px);
        margin: 0;
      }

      .theme-picker {
        --simple-icon-width: 24px;
        --simple-icon-height: 24px;
        padding: 0;
        border: solid 3px var(--portfolio-lightGrey);
        border-radius: 50%;
        background-color: var(--portfolio-white);
        z-index: 4;
        color: var(--portfolio-darkGrey);
        transition: color .3s, border .3s;
      }

      header .theme-picker {
        position: absolute;
        top: 8px;
        right: 6px;
      }

      /* Tags */
      .tag-list {
        flex-direction: row;
        flex-wrap: wrap;
        list-style-type: none;
        margin: 0 0 20px 0;
        padding: 0;
        border-top: 3px solid var(--portfolio-lightDark-blackWhite);
        border-bottom: 1px solid var(--portfolio-lightDark-blackWhite);
      }

      .tag-list li {
        margin: 0 10px 0 0;
        padding-top: 5px;
        padding-bottom: 5px;
      }

      .tag-list li a {
        color: var(--portfolio-lightDark-blackWhite);
        font-weight: 400;
        font-size: clamp(20px, 3vw, 27.5px);
        text-transform: uppercase;
      }

      /* Breadcrumb */
      .breadcrumb {
        display: flex;
        margin: 0 auto;
        margin-top: 4px;
        padding: 0 22px;
        height: clamp(40px, 5vw, 60px);
        max-width: 1236px;
        align-items: center;
        gap: 10px;
        color: var(--portfolio-lightDark-blackWhite);
        font-family: var(--portfolio-font-header);
        font-size: clamp(14px, 2vw, 18px);
        view-transition-name: location;
      }

      .breadcrumb a {
        color: var(--portfolio-lightDark-blackWhite);
        text-decoration: none;
        border-bottom: 2px solid var(--portfolio-lightDark-bg);
        font-weight: 450;
        transition: .3s ease-in-out;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        padding-bottom: 4px;
      }

      .breadcrumb-arrow {
        color: var(--portfolio-accentHighlight);
        transition: color .3s ease-in-out;
        padding-bottom: 4px;
      }

      .breadcrumb-parent {
        color: var(--portfolio-lightDark-blackWhite);
        transition: color .3s ease-in-out;
        padding-bottom: 4px;
      }

      .breadcrumb-split {
        color: var(--portfolio-accentHighlight);
        transition: color .3s ease-in-out;
        padding-bottom: 4px;
      }

      .breadcrumb-title {
        font-weight: bold;
        transition: color .3s ease-in-out;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        padding-bottom: 4px;
      }

      .breadcrumb a:hover,
      .breadcrumb a:focus{
        border-bottom: 2px solid var(--portfolio-accentHighlight);
      }
      
      /* Layouts */
      .container {
        margin: 64px auto;
        width: 90%;
        max-width: 840px;
        text-align: left;
        view-transition-name: location;
      }

      #contentcontainer {
        min-height: 50vh;
      } 

      #slot {
        min-height: 0vh;
      }

      .listing-titlecontainer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 20px;
        view-transition-name: location;
      }

      #listing-filter {
        font-size: 1rem;
        padding: 0.5em;
        max-width: 240px;
        width: 100%;
      }

      .list-filter-label {
        font-size: 14px;
        margin-right: 54px;
      }

      .listing-category {
        font-family: var(--portfolio-font-body);
        font-size: var(--portfolio-fontsize-responsive);
        text-transform: uppercase;
        border-top: 6px solid var(--portfolio-lightDark-blackWhite);
        min-height: 36px;
        transition: color .3s;
      }

      .listing-category a {
        color: var(--portfolio-lightDark-blackWhite);
      }

      .listing-grid {
        display: grid;
        gap: 24px;
        width: 100%;
        view-transition-name: location;
        grid-template-columns: repeat(4, 1fr);
      }

      div .listing-card {
        width: 188px;
        margin-bottom: 48px;
        text-decoration: none;
        transition: .4s;
      }

      .listing-cardimg {
        background-color: var(--portfolio-lightDark-cardImg);
        border-radius: 6px;
        margin-bottom: 12px;
        height: 120px;
        transition: all 0.2s ease-in-out;
        overflow: hidden;
        display: block;
      }

      .listing-cardimg img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .listing-cardtitle {
        color: var(--portfolio-lightDark-blackWhite);
        text-decoration: underline;
        text-decoration-color: var(--portfolio-lightDark-bg);
        text-decoration-thickness: 4px !important;
        text-underline-offset: 8px;
        font-family: var(--portfolio-font-header);
        font-weight: 400;
        line-height: 1.7;
        font-size: clamp(15px, 2vw, 21px);
        text-transform: uppercase;
        margin-bottom: 5.5px;
        transition: color, text-decoration-color .3s ease-in-out;
      }

      .listing-cardtag {
        color: var(--portfolio-lightDark-cardTag);
        font-family: var(--portfolio-font-body);
        font-size: clamp(10px, 2vw, 16px);
        font-weight: 400;
        transition: .3s;
      }

      .listing-card:hover .listing-cardtitle,
      .listing-card:focus .listing-cardtitle{
        text-decoration-color: var(--portfolio-accentHighlight);
      }

      .listing-card:hover .listing-cardimg,
      .listing-card:focus .listing-cardimg {
        box-shadow: rgba(0, 0, 0, 0.25) 0px 0px 10px 0px;
      }

      /* Pagination */
      .pagination {
        max-width: 840px;
        margin: 0 auto;
        padding: 0 22px;
        display: flex;
        gap: 24px;
        flex-direction: row;
        align-items: center;
        view-transition-name: location;
      }
      .pagination a {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        overflow: hidden;
        width: 400px;
        height: clamp(48px, 8vw, 96px);
        border-radius: 8px;
        color: var(--portfolio-white);
        background-color: var(--portfolio-lightGrey);
        text-decoration: underline;
        text-decoration-color: var(--portfolio-lightGrey);
        text-decoration-thickness: 4px;
        text-underline-offset: 8px;
        line-height: 1.8;
        font-family: var(--portfolio-font-header);
        font-weight: 400;
        transition: background-color .3s, text-decoration-color .3s, box-shadow .3s;
      }
      .pagination-text {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        text-overflow: ellipsis;
      }
      .pagination a simple-icon-lite {
        --simple-icon-color: var(--portfolio-white);
        --simple-icon-width: clamp(24px, 4vw, 40px);
        --simple-icon-height: clamp(24px, 4vw, 40px);
      }
      .pagination a:hover,
      .pagination a:focus {
        text-decoration-color: var(--portfolio-darkGrey);
        box-shadow: rgba(0, 0, 0, 0.25) 0px 0px 10px 0px;
      }
      .pagination a.prev {
        margin-left: 24px;
        margin-right: auto;
        padding-right: 12px;
        justify-content: flex-start;
      }
      .pagination a.next {
        margin-right: 24px;
        margin-left: auto;
        padding-left: 12px;
        justify-content: flex-end;
      }

      /* Media queries */
      @media (max-width: 60em) {
        .listing-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        div .listing-card {
          width: 100%;
          margin-bottom: 36px;
        }
        .listing-cardimg {
          height: 210px;
        }
        site-active-title h1 {
          font-size: 72px;
        }
        .pagination {
          flex-direction: column;
          gap: 16px;
        }
        .pagination-text {
          -webkit-line-clamp: 1;
          overflow: hidden;
          padding: 4px 0;
          line-height: 2;
        }
        .pagination a.prev,
        .pagination a.next {
          margin-left: 0;
          margin-right: 0;
          width: 100%;
        }
      }

      @media (max-width: 37.5em) {
        .listing-grid {
          grid-template-columns: repeat(1, 1fr);
        }
        div .listing-card {
          margin-bottom: 24px;
        }
        .listing-cardimg {
          height: 240px;
        }
        site-active-title h1 {
          font-size: clamp(56px, 12vw, 64px);
        }
      }

      /* Theme colors */
      :host([site-theme="earth"]) {
        --portfolio-menuItemUnderline:var(--portfolio-earth-accentLight);
        --portfolio-lightGrey: var(--portfolio-earth-accentLight);
        --portfolio-accentHighlight: var(--portfolio-earth-accentLight);
        --portfolio-darkGrey: var(--portfolio-earth-accentDark);
        --portfolio-lightDark-link: light-dark(var(--portfolio-earth-accentDark), var(--portfolio-earth-accentLight));
        --portfolio-lightDark-cardTag: light-dark(
          var(--portfolio-earth-accentDark),
          var(--portfolio-earth-accentLight)
        );
      }

      :host([site-theme="water"]) {
        --portfolio-menuItemUnderline:var(--portfolio-water-accentLight);
        --portfolio-lightGrey: var(--portfolio-water-accentLight);
        --portfolio-accentHighlight: var(--portfolio-water-accentLight);
        --portfolio-darkGrey: var(--portfolio-water-accentDark);
        --portfolio-lightDark-link: light-dark(var(--portfolio-water-accentDark), var(--portfolio-water-accentLight));
        --portfolio-lightDark-cardTag: light-dark(
          var(--portfolio-water-accentDark),
          var(--portfolio-water-accentLight)
        );
      }

      :host([site-theme="fire"]) {
        --portfolio-menuItemUnderline:var(--portfolio-fire-accentLight);
        --portfolio-lightGrey: var(--portfolio-fire-accentLight);
        --portfolio-accentHighlight: var(--portfolio-fire-accentLight);
        --portfolio-darkGrey: var(--portfolio-fire-accentDark);
        --portfolio-lightDark-link: light-dark(var(--portfolio-fire-accentDark), var(--portfolio-fire-accentLight));
        --portfolio-lightDark-cardTag: light-dark(
          var(--portfolio-fire-accentDark),
          var(--portfolio-fire-accentLight)
        );
      }

      :host([site-theme="sand"]) {
        --portfolio-menuItemUnderline:var(--portfolio-sand-accentLight);
        --portfolio-lightGrey: var(--portfolio-sand-accentLight);
        --portfolio-accentHighlight: var(--portfolio-sand-accentLight);
        --portfolio-darkGrey: var(--portfolio-sand-accentDark);
        --portfolio-lightDark-link: light-dark(var(--portfolio-sand-accentDark), var(--portfolio-sand-accentLight));
        --portfolio-lightDark-cardTag: light-dark(
          var(--portfolio-sand-accentDark),
          var(--portfolio-sand-accentLight)
        );
      }

      :host([site-theme="rose"]) {
        --portfolio-menuItemUnderline:var(--portfolio-rose-accentLight);
        --portfolio-lightGrey: var(--portfolio-rose-accentLight);
        --portfolio-accentHighlight: var(--portfolio-rose-accentLight);
        --portfolio-darkGrey: var(--portfolio-rose-accentDark);
        --portfolio-lightDark-link: light-dark(var(--portfolio-rose-accentDark), var(--portfolio-rose-accentLight));
        --portfolio-lightDark-cardTag: light-dark(
          var(--portfolio-rose-accentDark),
          var(--portfolio-rose-accentLight)
        );
      }

      :host([site-theme="violet"]) {
        --portfolio-menuItemUnderline:var(--portfolio-violet-accentLight);
        --portfolio-lightGrey: var(--portfolio-violet-accentLight);
        --portfolio-accentHighlight: var(--portfolio-violet-accentLight);
        --portfolio-darkGrey: var(--portfolio-violet-accentDark);
        --portfolio-lightDark-link: light-dark(var(--portfolio-violet-accentDark), var(--portfolio-violet-accentLight));
        --portfolio-lightDark-cardTag: light-dark(
          var(--portfolio-violet-accentDark),
          var(--portfolio-violet-accentLight)
        );
      }
    `]}testEditMode(t){this.editMode?(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()):t.currentTarget.blur()}_renderListing(){const t=this.selectedTag?this.items.filter((t=>{let i=s(t.metadata.tags);return!!i&&i.includes(this.selectedTag)})):this.items,e=this.selectedTag?this.categoryTags.filter((i=>t.some((t=>{let e=s(t.metadata.tags);return!!e&&e.includes(i)})))):this.categoryTags;return i`
      <!-- Render cards based on filtered tags -->
      ${e.length>0?e.map((e=>i`
              <h2 class="listing-category"><a tabindex="${this.editMode?"-1":"0"}" ?disabled="${this.editMode}" @click="${this.testEditMode}" href="x/tags?tag=${e.trim()}">${e}</a></h2>
              <div class="listing-grid">
                ${t.filter((t=>{let i=s(t.metadata.tags);return!!i&&i.includes(e)})).map((t=>{let e=s(t.metadata.tags).split(",")[1];return i`
                    <a tabindex="${this.editMode?"-1":"0"}" ?disabled="${this.editMode}" class="listing-card" href="${t.slug}" @click="${this.testEditMode}">
                      <div class="listing-cardimg">
                        <img src="${getPostLogo(t)}" onerror="this.style.display='none'" alt="" loading="lazy"
                            decoding="async"
                            fetchpriority="low" />
                      </div>
                      <div class="listing-cardtitle">${t.title}</div>
                      <div class="listing-cardtag">${e}</div>
                    </a>
                  `}))}
              </div>
            `)):i``}

      <!-- Render cards with no tags -->
      ${!this.selectedTag&&this.items.some((t=>!s(t.metadata.tags)))?i`
        <div class="listing-category"></div>
        <div class="listing-grid">
          ${this.items.filter((t=>!s(t.metadata.tags))).map((t=>i`
            <a class="listing-card" href="${t.slug}" tabindex="${this.editMode?"-1":"0"}" ?disabled="${this.editMode}" @click="${this.testEditMode}">
              <div class="listing-cardimg">
                <img src="${getPostLogo(t)}" onerror="this.style.display='none'" alt="" loading="lazy"
                    decoding="async"
                    fetchpriority="low" />
              </div>
              <div class="listing-cardtitle">${t.title}</div>
            </a>
          `))}
        </div>
      `:""}
    `}HAXSiteRenderXTagsItems(t){return i`
    <div part="listing-grid">
      ${t.map((t=>i`
        <a class="listing-card" href="${t.slug}" part="listing-card">
          <div class="listing-cardimg" part="listing-cardimg">
            <img src="${t.metadata.image}" onerror="this.style.display='none'" part="listing-cardimg-img">
          </div>
          <div class="listing-cardtitle" part="listing-cardtitle">${t.title}</div>
        </a>`))}
    </div>`}setLayout(t){globalThis.document&&globalThis.document.startViewTransition?globalThis.document.startViewTransition((()=>{this.activeLayout=t})):this.activeLayout=t}toggleSiteTheme(t){switch(this.siteTheme){case"earth":this.siteTheme="water";break;case"water":this.siteTheme="fire";break;case"fire":this.siteTheme="sand";break;case"sand":this.siteTheme="rose";break;case"rose":this.siteTheme="violet";break;case"violet":this.siteTheme="";break;default:this.siteTheme="earth"}}render(){return i`
      <header>
        <div class="header-inner">
          <a tabindex="${this.editMode?"-1":"0"}" ?disabled="${this.editMode}" id="site-title" @click="${this.testEditMode}" href="${this.homeLink}">${this.siteTitle}</a>
          <nav>
            ${this.topItems.map((t=>i`
                  <a
                    tabindex="${this.editMode?"-1":"0"}"
                    ?disabled="${this.editMode}"
                    @click="${this.testEditMode}"
                    class="menu-item ${this.activeItem&&(t.id===this.activeItem.id||this.ancestorItem&&t.id===this.ancestorItem.id)?"active":""}"
                    href="${t.slug}"
                  >
                    ${t.title}
                  </a>
                `))}
          </nav>
          ${this.menuOverflow.length>0?i`
              <div class="mobile-menu-wrapper">
                <button type="button" class=${this.menuOpen?"close":""} @click="${()=>this.menuOpen=!this.menuOpen}">
                  <span class="visually-hidden">Toggle Menu</span>
                  <div class="navicon"></div>
                </button>
                <ul class="hidden-links ${this.menuOpen?"":"hidden"}">
                  ${this.menuOverflow.map((t=>i`
                    <li>
                      <a
                        class="${this.activeItem&&(t.id===this.activeItem.id||this.ancestorItem&&t.id===this.ancestorItem.id)?"active":""}"
                        href="${t.slug}"
                        tabindex="${this.editMode?"-1":"0"}"
                        ?disabled="${this.editMode}"
                        @click="${this.testEditMode}"
                      >
                        ${t.title}
                      </a>
                    </li>`))}
                </ul>
              </div>
            `:""}
        </div>
        ${0==this.menuOverflow.length?i`
              <simple-icon-button-lite title="Change theme" label="Change theme" icon="image:style" class="theme-picker" @click="${this.toggleSiteTheme}"></simple-icon-button-lite>
            `:""}
      </header>
      
      <div class="breadcrumb">
        ${this.activeParent?i`
            <a tabindex="${this.editMode?"-1":"0"}" ?disabled="${this.editMode}" href=${this.activeParent.slug} @click="${this.testEditMode}">
              <span class="breadcrumb-arrow">←</span>
              <span class="breadcrumb-parent">${this.activeParent.title}</span>
            </a>
            <span class="breadcrumb-split">/</span>
            <span class="breadcrumb-title">${this.activeItem.title}</span>
          `:""}
      </div>

      ${"media"==this.activeLayout?i`<site-active-media-banner></site-active-media-banner>`:""}

      <div id="contentcontainer" class="container">
        ${"listing"==this.activeLayout?i`
              <div class="listing-titlecontainer">
                <site-active-title></site-active-title>
                <!-- Render select for filtering tags (only appears if >1 tag OR 1 tag and items with no tag) -->
                ${this.categoryTags.length>1||this.categoryTags.length>0&&this.items.some((t=>!t.metadata.tags))?i`
                    <label class="list-filter-label" for="listing-filter">Tag filter:</label>
                    <select ?disabled="${this.editMode}" id="listing-filter" @change=${t=>this.selectedTag=t.target.value}>
                      <option value="" ?selected="${""===this.selectedTag}">All</option>
                      ${this.categoryTags.map((t=>i`
                          <option value="${t}" ?selected="${this.selectedTag===t}">
                            ${t}
                          </option>`))}
                    </select>`:""}
              </div>
          `:i`
                <site-active-title></site-active-title>
                ${this.activeTags&&this.activeTags.length>0?i`
                      <ul class="tag-list">
                        ${("listing"===this.activeLayout?this.activeTags:this.activeTags.slice(1)).map((t=>i`<li><a tabindex="${this.editMode?"-1":"0"}" @click="${this.testEditMode}" ?disabled="${this.editMode}" href="x/tags?tag=${t.trim()}">${t}</a></li>`))}
                      </ul>
                  `:""}
          `}

        ${"listing"==this.activeLayout?this._renderListing():""}

        <div id="slot"><slot></slot></div>
      </div>

      <div class="pagination">
        ${this.activeParent?i`
          ${this.prevSibling?i`
            <a
              class="prev"
              tabindex="${this.editMode?"-1":"0"}"
              ?disabled="${this.editMode}"
              href="${this.prevSibling.slug}"
              @click="${this.testEditMode}"
            >
              <simple-icon-lite icon="icons:chevron-left"></simple-icon-lite>
              <span class="pagination-text">${this.prevSibling.title}</span>
            </a>
          `:""}
          ${this.nextSibling?i`
            <a
              tabindex="${this.editMode?"-1":"0"}"
              ?disabled="${this.editMode}"
              class="next"
              href="${this.nextSibling.slug}"
              @click="${this.testEditMode}"
            >
              <span class="pagination-text">${this.nextSibling.title}</span>
              <simple-icon-lite icon="icons:chevron-right"></simple-icon-lite>
            </a>
          `:""}
        `:""}
      </div>

      <footer>
        <div> 
          <div>Page number: ${this.pageCurrent} of ${this.pageTotal}</div>
          <div>Site generated: ${this.lastUpdated}</div>
          <div>Copyright: ${this.copyrightYear} ${a.manifest.author}</div>
          <div><a class="footer-link" @click="${this.testEditMode}" tabindex="${this.editMode?"-1":"0"}" href="x/tags" ?disabled="${this.editMode}">View Content by Tag</a></div>
        </div>
        <div
          class="license-body"
          xmlns:cc="${this.licenseLink}"
          xmlns:dc="http://purl.org/dc/elements/1.1/"
        >
          ${this.licenseImage?i`
                <a
                  class="big-license-link"
                  target="_blank"
                  href="${this.licenseLink}"
                  rel="noopener noreferrer"
                >
                  <img
                    loading="lazy"
                    decoding="async"
                    fetchpriority="low"
                    alt="${this.licenseName} graphic"
                    src="${this.licenseImage}"
                  />
                </a>
              `:""}
        </div>
        <simple-icon-button-lite icon="image:style" title="Change theme" label="Change theme" class="theme-picker" @click="${this.toggleSiteTheme}"></simple-icon-button-lite>
        <scroll-button @click="${t=>t.currentTarget.blur()}"></scroll-button>
      </footer>
    `}}globalThis.customElements.define(CleanPortfolioTheme.tag,CleanPortfolioTheme);